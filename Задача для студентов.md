## Портирование web сервиса

Есть сайт, одна из страниц которого выполняет функцию поисковика логов по различным критериям. На данный момент он реализован как streamlit приложение, но сейчас необходимо перевести его в формат более классического web сервиса, например с использованием flask или FastAPI (Python-основа приложения более предпочтительна), ради большей, чем у streamlit, гибкости и возможности тонкой настройки.

### Исходный интерфейс
*В прикреплённых изображениях*
### Требования к функционалу

- [ ] Основная форма поиска повторяет все фильтры из оригинала:
	- [ ] Не учитывать место записи лога или указать его
		- [ ] Карта для выбора конкретных полигонов локаций
		- [ ] Тепловая карта маршрутов (неплохо сделать её совмещённой с выбором полигонов, с возможностью включения и отключения)
	- [ ] Выбор что использовать для поиска - топики или типы топиков
	- [ ] Строка с мультивыбором самих топиков (или их типов)
	- [ ] Не учитывать даты или ограничить промежуток
	- [ ] Не учитывать время или указать часы/положение солнца
	- [ ] Не учитывать погоду или указать нужную из мультивыбора
- [ ] Иммитация существующих http запросов к сервису хранилища логов (можно реализовать просто функциями-пустышками, возвращающими статичные данные):
	- [ ] Получение списка всех топиков
	- [ ] Получение списка всех типов топиков
	- [ ] Получение вариантов погоды
	- [ ] Получение отфильтрованного списка логов, соответствующих критериям
	- [ ] Получение полной информации об одном конкретном логе
	- [ ] Получение GIF превью для конкретного лога по конкретному топику
- [ ] Вывод найденных логов в формате таблицы со следующими параметрами:
	- Путь до лога на smb сервере
	- Наличие маршрута у лога
	- Наличие GIF превью у лога
	- Размер лога в гигабайтах
	- Дата записи лога
	- Время записи лога
- [ ] Возможность открытия модального окна при нажатии на любой из найденных логов с более подробной информацией о нём: 
	- Путь к логу 
	- Открытие ссылки на маршрут лога на картах и превью карты с этим маршрутом, если таковой у лога имеется
	- Список тописков лога
	- GIF превью лога (если имеются) с указанием из какого топика они формированы.

### Примеры используемых данных

#### Варианты погоды
Запрос на `/get_weather_keys (GET)`
Формат ответа: 
```json
{
	(str) message: "OK",
	(list) data: ["Ясная погода", "Дождь", ..., "Туман"]
}
```

#### Варианты топиков
Запрос на `/get_topics (GET)`
Формат ответа ```
```json
{
	(str) message: "OK",
	(set) data: ("/tf_static", "/sensing/camera/near", ..., "/diagnostics")
}
```

#### Варианты типов топиков
Запрос на `/get_topic_types (GET)`
Формат ответа```
```json
{
	(str) message: "OK",
	(set) data: ("tf2_msgs/msg/TFMessage", "sensor_msgs/msg/Image", ..., "diagnostic_msgs/msg/DiagnosticArray")
}
```

#### Поиск логов
Запрос на `/search_logs (POST)`
Формат запроса
```json
{
	filters: {
        area: str, 
# Варианты - ["Город", "НАМИ", "Область на карте", "Не учитывать область"]
        map_polygons: list, 
# Пустой список, либо список в формате [{"geometry": {"coordinates": [x, y]}, ...}] 
# (Такие списки генерирует streamlit_folium, при необходимости будет проще использовать его)
        selected_topics: list, 
# Список топиков, например ["/sensing/camera/CF", "/tf_static"]
        date_start: str, 
# Начиная с какой даты искать в формате '%Y-%m-%d'. 
        date_end: str, 
# До какой даты искать
# Даты учитываются только при указании и начала и конца промежутка
        time_slider: cortage, 
# С какого по какой час искать в формате (start_hour, end_hour) в 24-часовом формате
        sun_slider: cortage, 
# Фильтр по положению солнца в формате (min_sun, max_sun), где 0 - полная темнота, 1 - первые и последние лучи, 3 - восход/закат, 10 - пик солнца
# Числа в промежутках между этими значениями тоже работают, они вычисляются автоматически
        weather_types: list 
# Список с подходящими вариантами погоды, например ["В основном ясно", "Переменная облачность"]
    }
}
```
Формат ответа
```json
{
    message: str, 
# Результат запроса, если всё хорошо, то вернётся "OK"
    data: [[path, map_link, size, date, time], ...] 
# Упорядоченный список подходящих логов, параметры каждого из которых так же хранятся в списке. 
# Все элементы кроме size хранятся в строковом формате
}
```
Пример запроса
```python
req_data = {
    "filters": {
        'area': 'Область на карте', 
        'map_polygons': [{'type': 'Feature', 'properties': {}, 'geometry': {'type': 'Polygon', 'coordinates': [[[37.522087, 55.844024], [37.522087, 55.846337], [37.532043, 55.846337], [37.532043, 55.844024], [37.522087, 55.844024]]]}}], 
        'selected_topics': ['/perception/object_recognition/objects'], 
        'date_start': '2024-05-19', 
        'date_end': '2025-03-03',
        'sun_slider': (4, 8), 
        'weather_types': ['В основном ясно']
    }
}
res = requests.post("http://graphics2:5002/search_logs", json=req_data)
res.json()
```
Вывод:
```json
{
    'message': 'OK',
    'data': [
        [
            'smb://server.address/avd/ros_logs/foxy/city/2024-05/2024-05-27_log_1',
            'https://map.project-osrm.org/?z=15&center=55.845204%2C37.526332&loc=55.845227%2C37.528782...&loc=55.845108%2C37.523840&hl=en&alt=0&srv=1',
            1.6,
            '2024/05/27',
            '07:50:01'
        ],
        ...
    ]
}
```

#### Получение информации о конкретном логе
Запрос на `/get_specified_log (POST)`
Формат запроса
```json
{
	(str) log: "smb://server.addr/avd/log/1"
}
```
Формат ответа
```json
{
	message: "OK",
	data: {
		smb://server.addr/avd/log/1: {
			date: "21/04/2022 16:12:25",
			duration_in_seconds: 24.51703648,
			map_link: None,
			size: 11.39,
			topics: [
				{
					message_count: 25,
					name: /tf_static,
					type: tf2_msgs/msg/TFMessage
				},
				{
					message_count: 689,
					name: /sensing/camera/near,
					type: sensor_msgs/msg/Image
				}
			]
		}
	}
}
```